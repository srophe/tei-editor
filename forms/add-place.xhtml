<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <title>Create New Gazetteer Record</title>
        <meta name="author" content="wsalesky at gmail.com"/>
        <meta name="description" content="Search Controlled Vocabularies"/>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"/>
        <link rel="stylesheet" type="text/css" href="../resources/css/xforms.css"/>
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css"/>
        <!-- jquery -->
        <script type="text/javascript" charset="utf-8" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">/**/</script>
        
        <!-- Latest compiled and minified JavaScript -->
        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"/>
    </head>
    <body class="soria" style="margin:30px;">
        <div>
            <div style="display:none">
                <xf:model id="m-place">
                    <!-- Generate new in xquery, populate place-id -->
                    <!-- Blank records with default teiHeader values prepopulated -->
                    <xf:instance xmlns="" id="i-rec" src="xml-templates/place.xml"/>
                    <!-- Template used for building optional elements. May be a better way to handle that  -->
                    <xf:instance xmlns="" id="i-template" src="xml-templates/template.xml"/>
                    <!-- Confessions for looking up confessions, perhaps should be a submodule? -->
                    <xf:instance xmlns="" id="i-confessions" src="/exist/apps/srophe/documentation/confessions.xml"/>
                    <xf:instance xmlns="" id="i-bibl" src="../services/bibl-list.xql"/>
                    <xf:instance xmlns="" id="i-new-bibl">
                        <bibl xmlns="http://www.tei-c.org/ns/1.0">
                            <ptr target="http://syriaca.org/bibl/"/>
                        </bibl>
                    </xf:instance>
                    <xf:instance xmlns="" id="i-blank-bibl">
                        <bibl xmlns="http://www.tei-c.org/ns/1.0" xml:id="bibnum">
                            <author/>
                            <editor/>
                            <title level="m" xml:lang="en"/>
                            <ptr target="http://syriaca.org/bibl/"/>
                            <citedRange unit="pp"/>
                        </bibl>
                    </xf:instance>
                    <xf:instance xmlns="" id="i-uri">
                        <data>
                            <id>http://syriaca.org/bibl/12</id>
                        </data>
                    </xf:instance>
                    <xf:submission id="s-load-source" resource="../services/bibl-list.xql" method="get" ref="instance('i-uri')//id" replace="instance" targetref="instance('i-new-bibl')"/>
                    <xf:submission id="s-save" action="submit.xql" ref="instance('i-rec')" instance="new" replace="all" method="post"/>

                    <!-- this puts the cursor in the search field when the form loads -->
                    <!--<xf:setfocus ev:event="xforms-ready" control="q"/>-->
                    <!--<xf:bind id="ref-value" readonly="false()" nodeset="instance('i-selected')/tei:TEI/child::*" calculate="instance('i-results')/tei:TEI/child::*[@ref = instance('i-selected')/tei:TEI/child::*/@ref]/text()"/>-->
                    <!-- Bind: title m = gazetter or have populated default values, for title and editors? -->
                    <!-- Bind: title a= title[@syriaca-headword] -->
                </xf:model>
            </div>
            <!-- List all existing titles -->
            <div class="section">
                <h1>Create New Gazetteer Record</h1>
                <p class="text-muted">Instructions, best practices, could be a modal pop up.</p>
                <xf:group ref="instance('i-rec')//tei:place">
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingOne">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">Place Name</a>
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                            <div class="panel-body">
                                <div class="tei-element">
                                    <fieldset class="well">
                                        <label>Place </label>
                                    <!-- Place Name repeat (this could be stored in xml and pulled into form at build time, would still need to write trigger manually I would think?) -->
                                        <xf:repeat ref="tei:placeName" id="new-place-name">
                                            <xf:trigger appearance="minimal" class="btn remove">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" ref="."/>
                                            </xf:trigger>
                                            <xf:input ref=".">
                                                <xf:label>Name</xf:label>
                                            </xf:input>
                                        <!-- NOTE: this infor may be in the tei header for each rec type
                                             Interesting alternative to the switch: http://www.cmprofessionals.eu/xforms-(en)/xforms-tutorial/xforms-tutorial-controls-open-and-closed-selections.aspx -->
                                            <xf:select1 ref="@xml:lang">
                                                <xf:label>Language</xf:label>
                                                <xf:item>
                                                    <xf:label>--- Select Language ---</xf:label>
                                                    <xf:value/>
                                                </xf:item>
                                                <xf:itemset ref="instance('i-rec')//tei:profileDesc/tei:langUsage/tei:language">
                                                    <xf:label ref="."/>
                                                    <xf:value ref="@ident"/>
                                                </xf:itemset>
                                            </xf:select1>
                                            <xf:select1 ref="@source" class="input-small">
                                                <xf:label>Source:</xf:label>
                                                <xf:itemset ref="instance('i-rec')//tei:text/descendant::tei:bibl">
                                                    <xf:label ref="tei:title"/>
                                                    <xf:value ref="@xml:id"/>
                                                </xf:itemset>
                                            </xf:select1>
                                        <!-- Work out js for this, used on controlled vocab demo -->
                                            <button type="text" class="btn btn-link btn-source" data-toggle="modal" data-target="#modal-source">New source</button>
                                            <div class="divider"/>
                                        </xf:repeat>
                                    </fieldset>
                                    <xf:trigger class="btn add" appearance="minimal">
                                        <xf:label>New Name</xf:label>
                                        <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" 
                                            ref="instance('i-rec')//tei:place/tei:placeName" at="last()" position="after" 
                                            origin="instance('i-template')//tei:place/tei:placeName"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingTwo">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Description
                                </a>
                            </h4>
                        </div>
                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                            <div class="panel-body">
                                <div class="tei-element">
                                    <fieldset class="well">
                                        <label>Description</label>
                                        <xf:repeat ref="instance('i-rec')//tei:place/tei:desc" id="new-desc">
                                            <xf:trigger appearance="minimal" class="btn remove">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" ref="."/>
                                            </xf:trigger>
                                        <!-- Type? abstract YES/or no? -->
                                            <xf:select1 ref="@xml:lang">
                                                <xf:label>Language</xf:label>
                                                <xf:item>
                                                    <xf:label>--- Select Language ---</xf:label>
                                                    <xf:value/>
                                                </xf:item>
                                                <xf:item>
                                                    <xf:label>English</xf:label>
                                                    <xf:value>en</xf:value>
                                                </xf:item>
                                                <xf:item>
                                                    <xf:label>Vocalized West Syriac</xf:label>
                                                    <xf:value>syr-Syrj</xf:value>
                                                </xf:item>
                                                <xf:item>
                                                    <xf:label>Vocalized East Syriac</xf:label>
                                                    <xf:value>syr-Syrn</xf:value>
                                                </xf:item>
                                                <xf:item>
                                                    <xf:label>Arabic</xf:label>
                                                    <xf:value>ar</xf:value>
                                                </xf:item>
                                            </xf:select1>
                                            <xf:select1 ref="@source" class="input-small">
                                                <xf:label>Source:</xf:label>
                                                <xf:itemset ref="instance('i-rec')//tei:bibl">
                                                    <xf:label ref="tei:title"/>
                                                    <xf:value ref="@xml:id"/>
                                                </xf:itemset>
                                            </xf:select1>
                                            <xf:textarea ref="tei:quote" class="large"/>
                                        </xf:repeat>
                                    </fieldset>
                                    <xf:trigger class="btn add" appearance="minimal">
                                        <xf:label>New Description</xf:label>
                                        <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:desc" at="last()" position="after" origin="instance('i-template')//tei:place/tei:desc"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingThree">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Location
                                </a>
                            </h4>
                        </div>
                        <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                            <div class="panel-body">
                                <div class="tei-element">
                                    <fieldset class="well">    
                                        <!-- Need to work on more complex location element -->
                                        <xf:repeat ref="instance('i-rec')//tei:place/tei:location/tei:geo" id="new-coords">
                                            <xf:trigger appearance="minimal" class="btn remove">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" at="index('new-coords')"/>
                                            </xf:trigger>
                                            <xf:input ref=".">
                                                <xf:label>Coordinates</xf:label>
                                            </xf:input>
                                        </xf:repeat>
                                        <!-- Have two triggers, one for when there is a coord element (to group then) one for brand new, add to end of rec -->
                                        <xf:trigger class="btn add" appearance="minimal">
                                            <xf:label>Add coordinates</xf:label>
                                            <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:location[tei:geo]" at="last()" position="after" origin="instance('i-template')//tei:place/tei:location[tei:geo][1]"/>
                                        </xf:trigger>
                                    </fieldset>
                                    <fieldset class="well">    
                                        <!-- Need to work on more complex location element -->
                                        <xf:repeat ref="instance('i-rec')//tei:place/tei:location[not(tei:geo)]" id="new-location">
                                            <xf:trigger appearance="minimal" class="btn remove">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" at="index('new-location')"/>
                                            </xf:trigger>
                                            <xf:textarea ref="instance('i-rec')//tei:place/tei:location[@type='relative']" class="large">
                                                <xf:label>Location:</xf:label>
                                            </xf:textarea>
                                        </xf:repeat>
                                        <xf:trigger class="btn add" appearance="minimal">
                                            <xf:label>Add location</xf:label>
                                            <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:location[@type='relative']" at="last()" position="after" origin="instance('i-template')//tei:place/tei:location[@type='relative'][1]"/>
                                        </xf:trigger>
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingFour">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    Events
                                </a>
                            </h4>
                        </div>
                        <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                            <div class="panel-body">
                                <fieldset class="well">
                                    <xf:repeat ref="instance('i-rec')//tei:place/tei:event[not(@type='attestation')]" id="new-event">
                                        <div>
                                            <xf:trigger class="btn remove" appearance="minimal">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" ref="."/>
                                            </xf:trigger>
                                            <xf:input ref="tei:p">
                                                <xf:label>Event: </xf:label>
                                            </xf:input>
                                            <!-- Insert LANG -->
                                            <!-- Insert SOURC -->
                                        </div>
                                            <!-- Insert Dates -->    
                                    </xf:repeat>
                                </fieldset>
                                <xf:trigger class="btn add" appearance="minimal">
                                    <xf:label>New event</xf:label>
                                    <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:event" at="last()" position="after" origin="instance('i-template')//tei:place/tei:event[1]"/>
                                </xf:trigger>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingFive">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    Attestations
                                </a>
                            </h4>
                        </div>
                        <div id="collapseFive" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFive">
                            <div class="panel-body">
                                <fieldset class="well">
                                    <xf:repeat ref="instance('i-rec')//tei:place/tei:event[@type='attestation']" id="new-attestation">
                                        <xf:trigger class="btn remove" appearance="minimal">
                                            <xf:label/>
                                            <xf:delete ev:event="DOMActivate" ref="."/>
                                        </xf:trigger>
                                        <xf:textarea ref="tei:p">
                                            <xf:label>Attestation: </xf:label>
                                        </xf:textarea>
                                        <!-- ADD LANG -->
                                        <!-- ADD SOURCE -->
                                        <!-- ADD DATES -->
                                    </xf:repeat>
                                </fieldset>
                                <xf:trigger class="btn add" appearance="minimal">
                                    <xf:label>New attestation</xf:label>
                                    <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:event[@type='attestation'][1]" at="last()" position="after" origin="instance('i-template')//tei:place/tei:event[@type='attestation'][1]"/>
                                </xf:trigger>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingSix">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                                    Confessions    
                                </a>
                            </h4>
                        </div>
                        <div id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">
                            <div class="panel-body">
                                <div class="accordion-inner">
                                    <fieldset class="well">
                                        <xf:repeat ref="instance('i-rec')//tei:place/tei:state[@type='confession']" id="new-confession">
                                            <xf:trigger class="btn remove" appearance="minimal">
                                                <xf:label/>
                                                <xf:delete ev:event="DOMActivate" ref="."/>
                                            </xf:trigger>
                                            <xf:select1 ref="tei:label">
                                                <xf:label>Confession:</xf:label>
                                                <xf:itemset ref="instance('i-confessions')//tei:item">
                                                    <xf:label ref="child::tei:label"/>
                                                    <xf:value ref="@xml:id"/>
                                                </xf:itemset>
                                            </xf:select1>
                                            <!-- SOURCE -->
                                            <!-- DATES -->
                                            <!-- bind ref to confession bind bibl, or have dropdown -->
                                        </xf:repeat>
                                    </fieldset>
                                    <xf:trigger class="btn add" appearance="minimal">
                                        <xf:label>New confession</xf:label>
                                        <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:state[@type='confession']" at="last()" position="after" origin="instance('i-template')//tei:place/tei:state[@type='confession'][1]"/>
                                    </xf:trigger>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingSeven">
                            <h4 class="panel-title">
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseSeven" aria-expanded="false" aria-controls="collapseSeven">
                                    Notes
                                </a>
                            </h4>
                        </div>
                        <div id="collapseSeven" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSeven">
                            <div class="panel-body">
                                <fieldset class="well">
                                    <xf:repeat ref="instance('i-rec')//tei:place/tei:note" id="new-note">
                                        <xf:trigger class="btn remove" appearance="minimal">
                                            <xf:label/>
                                            <xf:delete ev:event="DOMActivate" ref="."/>
                                        </xf:trigger>
                                        <xf:select1 ref="@type">
                                            <xf:label>Type:</xf:label>
                                            <xf:item>
                                                <xf:label>--- Select Note Type ---</xf:label>
                                                <xf:value/>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Errata</xf:label>
                                                <xf:value>errata</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Corrigenda</xf:label>
                                                <xf:value>corrigenda</xf:value>
                                            </xf:item>
                                            <xf:item>
                                                <xf:label>Incerta</xf:label>
                                                <xf:value>incerta</xf:value>
                                            </xf:item>
                                        </xf:select1>
                                        <!-- Should there be a source? -->
                                        <xf:textarea ref="."/>
                                        <!-- select date type from dropdown, have input popup -->
                                    </xf:repeat>
                                </fieldset>
                                <xf:trigger class="btn" appearance="minimal">
                                    <xf:label>New note</xf:label>
                                    <xf:insert ev:event="DOMActivate" context="instance('i-rec')//tei:place" ref="instance('i-rec')//tei:place/tei:note" at="last()" position="after" origin="instance('i-template')//tei:place/tei:note"/>
                                </xf:trigger>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade modal-bibl" id="modal-source" tabindex="-1" role="dialog" aria-labelledby="modal-source-label" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Add New Source:</h4>
                            </div>
                            <div class="modal-body">
                                <xf:repeat ref="instance('i-uri')//id" id="uri">
                                    <h4>Select Source form Syriaca.org bibliography:</h4>
                                    <xf:select1 ref="." incremental="true">
                                        <xf:label/>
                                        <xf:itemset ref="instance('i-bibl')//tei:TEI">
                                            <xf:label ref="tei:title"/>
                                            <xf:value ref="tei:idno"/>
                                        </xf:itemset>
                                        <xf:action ev:event="xforms-value-changed">
                                            <xf:send submission="s-load-source"/>
                                        </xf:action>
                                    </xf:select1>
                                </xf:repeat>
                                <xf:group class="horiz-tab-menu">
                                    <xf:trigger appearance="minimal" class="tabs view" ref="instance('i-new-bibl')//tei:title">
                                        <xf:label>View Citation </xf:label>
                                        <xf:toggle case="view-bibl" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                    <xf:trigger appearance="minimal" class="tabs edit" ref="instance('i-new-bibl')//tei:title">
                                        <xf:label>Edit Citation </xf:label>
                                        <xf:toggle case="edit-bibl" ev:event="DOMActivate"/>
                                    </xf:trigger>
                                </xf:group>
                                <xf:switch id="bibl" class="tab-panel">
                                    <xf:case id="view-bibl" selected="true()">
                                        <xf:group class="view">
                                            <xf:repeat ref="instance('i-new-bibl')/tei:title" id="view-title">
                                                <xf:output ref=".">
                                                    <xf:label class="inline">Title: </xf:label>
                                                </xf:output>
                                                <xf:output ref="@level">
                                                    <xf:label class="inline">Level: </xf:label>
                                                </xf:output>
                                            </xf:repeat>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:author" id="view-auth">
                                                <xf:output ref=".">
                                                    <xf:label class="inline">Author: </xf:label>
                                                </xf:output>
                                            </xf:repeat>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:editor" id="view-editor">
                                                <xf:output ref=".">
                                                    <xf:label class="inline">Editor: </xf:label>
                                                </xf:output>
                                            </xf:repeat>
                                        </xf:group>
                                    </xf:case>
                                    <xf:case id="edit-bibl">
                                        <xf:group class="edit">
                                            <h4>Titles /
                                                <xf:trigger class="add" appearance="minimal">
                                                    <xf:label> Add Title</xf:label>
                                                    <xf:hint>Adds a new title element</xf:hint>
                                                    <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:title" at="last()" position="after" origin="instance('i-blank-bibl')/tei:title"/>
                                                    <!-- EXAMPLE of conditional insert, could be helpful for inserting when there is no title preset (not such an issue with bibl)
                                                    <xf:action>
                                                        <xf:insert context="instance('new-bibl')" at="last()" position="after"
                                                            origin="instance('blank-bibl')/tei:title"
                                                            if="count(instance('new-bibl')/tei:title) < 1"/>
                                                        <xf:insert at="first()" position="after"
                                                            origin="instance('blank-bibl')/tei:title"
                                                            ref="instance('new-bibl')/tei:title[last()]"
                                                            if="count(instance('new-bibl')/tei:title) > 1"/>                                
                                                    </xf:action>
                                                    -->
                                                </xf:trigger>
                                            </h4>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:title" id="source-title" appearance="compact" class="inline-repeat" incremental="true">
                                                <xf:trigger appearance="minimal" class="btn remove">
                                                    <xf:label/>
                                                    <xf:delete ev:event="DOMActivate" ref="."/>
                                                </xf:trigger>
                                                <xf:input ref="." class="input-md">
                                                    <xf:label>Title:</xf:label>
                                                </xf:input>
                                                <br/>
                                                <!-- Should be a controlled vocab pulled from schema -->
                                                <xf:select1 ref="@level" class="indent-form">
                                                    <xf:label>Level</xf:label>
                                                    <xf:item>
                                                        <xf:label>Article</xf:label>
                                                        <xf:value>a</xf:value>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>Manuscript</xf:label>
                                                        <xf:value>m</xf:value>
                                                    </xf:item>
                                                </xf:select1>
                                                <!-- Should be a controlled vocab, contact editors to add new values -->
                                                <xf:select1 ref="@xml:lang">
                                                    <xf:label>Language</xf:label>
                                                    <xf:item>
                                                        <xf:label>--- Select Language ---</xf:label>
                                                        <xf:value/>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>English</xf:label>
                                                        <xf:value>en</xf:value>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>Vocalized West Syriac</xf:label>
                                                        <xf:value>syr-Syrj</xf:value>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>Vocalized East Syriac</xf:label>
                                                        <xf:value>syr-Syrn</xf:value>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>Arabic</xf:label>
                                                        <xf:value>ar</xf:value>
                                                    </xf:item>
                                                </xf:select1>
                                            </xf:repeat>
                                            <h4>Authors /       
                                                <xf:trigger class="add" appearance="minimal">
                                                    <xf:label> Add Author</xf:label>
                                                    <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:author" at="last()" position="after" origin="instance('i-blank-bibl')/tei:author"/>
                                                </xf:trigger>
                                            </h4>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:author" id="source-author" appearance="compact" class="inline-repeat" incremental="true">
                                                <xf:trigger appearance="minimal" class="btn remove">
                                                    <xf:label/>
                                                    <xf:delete ev:event="DOMActivate" ref="."/>
                                                </xf:trigger>
                                                <xf:input ref="." class="input-md">
                                                    <xf:label>Author: </xf:label>
                                                </xf:input>
                                            </xf:repeat>
                                            <h4>Editors /             
                                                <xf:trigger class="add" appearance="minimal">
                                                    <xf:label> Add Editor</xf:label>
                                                    <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:editor" at="last()" position="after" origin="instance('i-blank-bibl')/tei:editor"/>
                                                </xf:trigger>
                                            </h4>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:editor" id="source-editor" appearance="compact" class="inline-repeat" incremental="true">
                                                <xf:trigger appearance="minimal" class="btn remove">
                                                    <xf:label/>
                                                    <xf:delete ev:event="DOMActivate" ref="."/>
                                                </xf:trigger>
                                                <xf:input ref="." class="input-md">
                                                    <xf:label>Editor: </xf:label>
                                                </xf:input>
                                            </xf:repeat>
                                            <h4 class="col-md-10">Cited Range / 
                                                <xf:trigger class="add" appearance="minimal">
                                                    <xf:label> Insert Cited Range</xf:label>
                                                    <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/child::*" at="last()" position="after" origin="instance('i-blank-bibl')/tei:citedRange"/>
                                                </xf:trigger>
                                            </h4>
                                            <xf:repeat ref="instance('i-new-bibl')/tei:citedRange" id="source-cite" appearance="compact" class="inline-repeat" incremental="true">
                                                <xf:trigger appearance="minimal" class="btn remove">
                                                    <xf:label/>
                                                    <xf:delete ev:event="DOMActivate" ref="."/>
                                                </xf:trigger>
                                                <xf:input ref="." class="input-md">
                                                    <xf:label>Cited Range: </xf:label>
                                                </xf:input>
                                                <xf:select1 ref="@xml:unit">
                                                    <xf:label>Unit</xf:label>
                                                    <xf:item>
                                                        <xf:label>--- Select Unit ---</xf:label>
                                                        <xf:value/>
                                                    </xf:item>
                                                    <xf:item>
                                                        <xf:label>pp</xf:label>
                                                        <xf:value>pp</xf:value>
                                                    </xf:item>
                                                </xf:select1>
                                            </xf:repeat>
                                        </xf:group>
                                    </xf:case>
                                </xf:switch>
                                <!-- Save/insert into main instance -->
                                <!--
                            <div>
                                <xf:trigger class="editTrigger btn" appearance="minimal">
                                    <xf:label>Save to Record</xf:label>
                                    <xf:insert ev:event="DOMActivate" context="instance('new')//tei:place" ref="instance('new')//tei:place/tei:bibl" at="last()" position="after" origin="instance('template')//tei:place/tei:bibl"/>
                                </xf:trigger>
                            </div>
                            -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <xf:trigger class="btn btn-default" appearance="minimal">
                                    <xf:label>Save to record</xf:label>
                                    <xf:insert ev:event="DOMActivate" context="instance('i-new')//tei:place" ref="instance('i-new')//tei:place/child::*" at="last()" position="after" origin="instance('i-new-bibl')"/>
                                    <!-- Will need to add source to field that triggers the popup... not sure how to do that. -->
                                    <!-- Would be nice to have a message from successful save -->
                                </xf:trigger>
                            </div>
                        </div>
                    </div>
                </div>
                </xf:group>
            </div>
        </div>
    </body>
</html>