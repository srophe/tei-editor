<?xml version="1.0" encoding="UTF-8"?>
<div xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:tei="http://www.tei-c.org/ns/1.0" xmlns:xf="http://www.w3.org/2002/xforms">
    <xf:repeat ref="instance('i-uri')//id" id="uri">
        <h4>Select Source form Syriaca.org bibliography:</h4>
        <xf:select1 ref="." incremental="true">
            <xf:label/>
            <xf:itemset ref="instance('i-bibl')//tei:TEI">
                <xf:label ref="tei:title"/>
                <xf:value ref="tei:idno"/>
            </xf:itemset>
            <xf:action ev:event="xforms-value-changed">
                <xf:send submission="s-load-source"/>
            </xf:action>
        </xf:select1>
    </xf:repeat>
    <xf:group class="horiz-tab-menu">
        <xf:trigger appearance="minimal" class="tabs view" ref="instance('i-new-bibl')//tei:title">
            <xf:label>View Citation </xf:label>
            <xf:toggle case="view-bibl" ev:event="DOMActivate"/>
        </xf:trigger>
        <xf:trigger appearance="minimal" class="tabs edit" ref="instance('i-new-bibl')//tei:title">
            <xf:label>Edit Citation </xf:label>
            <xf:toggle case="edit-bibl" ev:event="DOMActivate"/>
        </xf:trigger>
    </xf:group>
    <xf:switch id="bibl" class="tab-panel">
        <xf:case id="view-bibl" selected="true()">
            <xf:group class="view">
                <xf:repeat ref="instance('i-new-bibl')/tei:title" id="view-title">
                    <xf:output ref=".">
                        <xf:label class="inline">Title: </xf:label>
                    </xf:output>
                    <xf:output ref="@level">
                        <xf:label class="inline">Level: </xf:label>
                    </xf:output>
                </xf:repeat>
                <xf:repeat ref="instance('i-new-bibl')/tei:author" id="view-auth">
                    <xf:output ref=".">
                        <xf:label class="inline">Author: </xf:label>
                    </xf:output>
                </xf:repeat>
                <xf:repeat ref="instance('i-new-bibl')/tei:editor" id="view-editor">
                    <xf:output ref=".">
                        <xf:label class="inline">Editor: </xf:label>
                    </xf:output>
                </xf:repeat>
            </xf:group>
        </xf:case>
        <!-- Add title elements as includes, eventually -->
        <xf:case id="edit-bibl">
            <xf:group class="edit">
                <h4>Titles /
                    <xf:trigger class="add" appearance="minimal">
                        <xf:label> Add Title</xf:label>
                        <xf:hint>Adds a new title element</xf:hint>
                        <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:title" at="last()" position="after" origin="instance('i-blank-bibl')/tei:title"/>
                        <!-- EXAMPLE of conditional insert, could be helpful for inserting when there is no title preset (not such an issue with bibl)
                                                    <xf:action>
                                                        <xf:insert context="instance('new-bibl')" at="last()" position="after"
                                                            origin="instance('blank-bibl')/tei:title"
                                                            if="count(instance('new-bibl')/tei:title) < 1"/>
                                                        <xf:insert at="first()" position="after"
                                                            origin="instance('blank-bibl')/tei:title"
                                                            ref="instance('new-bibl')/tei:title[last()]"
                                                            if="count(instance('new-bibl')/tei:title) > 1"/>                                
                                                    </xf:action>
                                                    -->
                    </xf:trigger>
                </h4>
                <xf:repeat ref="instance('i-new-bibl')/tei:title" id="source-title" appearance="compact" class="inline-repeat" incremental="true">
                    <xf:trigger appearance="minimal" class="btn remove">
                        <xf:label/>
                        <xf:delete ev:event="DOMActivate" ref="."/>
                    </xf:trigger>
                    <xf:input ref="." class="input-md">
                        <xf:label>Title:</xf:label>
                    </xf:input>
                    <br/>
                    <!-- Should be a controlled vocab pulled from schema -->
                    <xf:select1 ref="@level" class="indent-form">
                        <xf:label>Level</xf:label>
                        <xf:item>
                            <xf:label>Article</xf:label>
                            <xf:value>a</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Manuscript</xf:label>
                            <xf:value>m</xf:value>
                        </xf:item>
                    </xf:select1>
                    <!-- Should be a controlled vocab, contact editors to add new values -->
                    <xf:select1 ref="@xml:lang">
                        <xf:label>Language</xf:label>
                        <xf:item>
                            <xf:label>--- Select Language ---</xf:label>
                            <xf:value/>
                        </xf:item>
                        <xf:item>
                            <xf:label>English</xf:label>
                            <xf:value>en</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Vocalized West Syriac</xf:label>
                            <xf:value>syr-Syrj</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Vocalized East Syriac</xf:label>
                            <xf:value>syr-Syrn</xf:value>
                        </xf:item>
                        <xf:item>
                            <xf:label>Arabic</xf:label>
                            <xf:value>ar</xf:value>
                        </xf:item>
                    </xf:select1>
                </xf:repeat>
                <h4>Authors /       
                    <xf:trigger class="add" appearance="minimal">
                        <xf:label> Add Author</xf:label>
                        <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:author" at="last()" position="after" origin="instance('i-blank-bibl')/tei:author"/>
                    </xf:trigger>
                </h4>
                <xf:repeat ref="instance('i-new-bibl')/tei:author" id="source-author" appearance="compact" class="inline-repeat" incremental="true">
                    <xf:trigger appearance="minimal" class="btn remove">
                        <xf:label/>
                        <xf:delete ev:event="DOMActivate" ref="."/>
                    </xf:trigger>
                    <xf:input ref="." class="input-md">
                        <xf:label>Author: </xf:label>
                    </xf:input>
                </xf:repeat>
                <h4>Editors /             
                    <xf:trigger class="add" appearance="minimal">
                        <xf:label> Add Editor</xf:label>
                        <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/tei:editor" at="last()" position="after" origin="instance('i-blank-bibl')/tei:editor"/>
                    </xf:trigger>
                </h4>
                <xf:repeat ref="instance('i-new-bibl')/tei:editor" id="source-editor" appearance="compact" class="inline-repeat" incremental="true">
                    <xf:trigger appearance="minimal" class="btn remove">
                        <xf:label/>
                        <xf:delete ev:event="DOMActivate" ref="."/>
                    </xf:trigger>
                    <xf:input ref="." class="input-md">
                        <xf:label>Editor: </xf:label>
                    </xf:input>
                </xf:repeat>
                <h4 class="col-md-10">Cited Range / 
                    <xf:trigger class="add" appearance="minimal">
                        <xf:label> Insert Cited Range</xf:label>
                        <xf:insert ev:event="DOMActivate" context="instance('i-new-bibl')" ref="instance('i-new-bibl')/child::*" at="last()" position="after" origin="instance('i-blank-bibl')/tei:citedRange"/>
                    </xf:trigger>
                </h4>
                <xf:repeat ref="instance('i-new-bibl')/tei:citedRange" id="source-cite" appearance="compact" class="inline-repeat" incremental="true">
                    <xf:trigger appearance="minimal" class="btn remove">
                        <xf:label/>
                        <xf:delete ev:event="DOMActivate" ref="."/>
                    </xf:trigger>
                    <xf:input ref="." class="input-md">
                        <xf:label>Cited Range: </xf:label>
                    </xf:input>
                    <xf:select1 ref="@xml:unit">
                        <xf:label>Unit</xf:label>
                        <xf:item>
                            <xf:label>--- Select Unit ---</xf:label>
                            <xf:value/>
                        </xf:item>
                        <xf:item>
                            <xf:label>pp</xf:label>
                            <xf:value>pp</xf:value>
                        </xf:item>
                    </xf:select1>
                </xf:repeat>
            </xf:group>
        </xf:case>
    </xf:switch>
</div>